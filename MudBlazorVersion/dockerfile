# Stage 1: Build the app using .NET SDK
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR "/src"

# Copy csproj and restore (caches layers for faster rebuilds)
COPY ["ellipsis.apps.csproj", "."]
RUN dotnet restore "ellipsis.apps.csproj"

# Copy source and build
COPY . .
WORKDIR "/src"
RUN dotnet build "ellipsis.apps.csproj" -c Release -o /app/build

# Publish static files (UseAppHost=false skips server host for standalone WASM)
FROM build AS publish
RUN dotnet publish "ellipsis.apps.csproj" -c Release -o /app/publish /p:UseAppHost=false

# Stage 2: Serve with Nginx
FROM nginx:alpine AS final
EXPOSE 80

## Copy published wwwroot to Nginx's static file dir
#WORKDIR /usr/share/nginx/html
#COPY --from=publish /app/publish/wwwroot .

## Copy custom Nginx config for SPA routing
#COPY nginx.conf /etc/nginx/nginx.conf
