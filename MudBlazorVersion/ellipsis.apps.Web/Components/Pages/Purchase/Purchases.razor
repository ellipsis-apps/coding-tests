@page "/purchases"
@using System.Globalization
@using MudBlazor.Components

<PageTitle>Purchases</PageTitle>
<h3>Purchases</h3>
<h6 style="color:blue;">Select a currency to see the converted purchase amount.</h6>
<h6 style="color:blue;">There may be no existing conversion rates for some transaction date/currency combinations.</h6>
<br />

<div style="width:90%">
	@if (GridData.Any())
	{
		<MudStack Class="justify-space-between mud-width-full">
			<MudStack Row Style="width: 300px">
				<MudAutocomplete T="string"
								 ValueChanged="OnCurrencyChangedAsync"
								 SearchFunc="SearchDropDownList"
								 Variant="Variant.Outlined"
								 HelperText="Select a Currency for conversion"
								 ResetValueOnEmptyText="true"/>
			</MudStack>

			<MudStack Row Style="width:100%;">
				<MudDataGrid T="ConvertedPurchase"
							 Items="@GridData"
				>
					<Columns>
						<PropertyColumn Property="x => x.Id" Title="Id" />
						<PropertyColumn Property="x => x.Description" Title="Description" />
						<PropertyColumn Property="x => x.TransactionDate" Title="Transaction Date" Format="yyyy-MM-dd"/>
						<PropertyColumn Property="x => x.PurchaseAmount" Title="Purchase Amount" Format="N2" CellStyle="text-align: right;" />
						<TemplateColumn Title ="Exchange Rate" CellStyle="text-align: right;">
							<CellTemplate>
								@{
									if (context.Item.ExchangeRate == 0m)
									{
										<span style="color:red;">No conversion exists!</span>
									}
									else
									{
										@context.Item.ExchangeRate.ToString("N2");
									}
								}
							</CellTemplate>
						</TemplateColumn>
						<TemplateColumn Title="Converted Amount" CellStyle="text-align: right;">
							<CellTemplate>
								@{
									if (context.Item.ConvertedAmount == 0m)
									{
										<span style="color:red;">No conversion exists!</span>
									}
									else
									{
										@context.Item.ConvertedAmount.ToString("N2");
									}
								}
							</CellTemplate>
						</TemplateColumn>
					</Columns>
					<PagerContent>
						<MudDataGridPager T="ConvertedPurchase" PageSizeOptions="new int[] { 5, 10, 20 }" />
					</PagerContent>
				</MudDataGrid>
			</MudStack>
		</MudStack>
	}
	else
	{
		<h3 style="color: red;">No purchases found!</h3>
	}
</div>
	
<!-- Manual test buttons -->
@* <div>
		<MudButton OnClick="TestPageChange" Color="Color.Primary">Test: Go to Page 2</MudButton>
		<MudButton OnClick="TestPageSizeChange" Color="Color.Secondary">Test: Change Page Size</MudButton>
	</div>*@
